!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Layzr=b()}(this,function(){"use strict";function a(a){this._lastScroll=0,this._ticking=!1,a=a||{},this._optionsContainer=document.querySelector(a.container)||window,this._optionsSelector=a.selector||"[data-layzr]",this._optionsAttr=a.attr||"data-layzr",this._optionsAttrRetina=a.retinaAttr||"data-layzr-retina",this._optionsAttrBg=a.bgAttr||"data-layzr-bg",this._optionsAttrHidden=a.hiddenAttr||"data-layzr-hidden",this._optionsThreshold=a.threshold||0,this._optionsCallback=a.callback||null,this._retina=window.devicePixelRatio>1,this._srcAttr=this._retina?this._optionsAttrRetina:this._optionsAttr,this._nodes=document.querySelectorAll(this._optionsSelector),this._handlerBind=this._requestScroll.bind(this),this._create()}return a.prototype._requestScroll=function(){this._lastScroll=this._optionsContainer===window?window.pageYOffset:this._optionsContainer.scrollTop+this._getOffset(this._optionsContainer),this._requestTick()},a.prototype._requestTick=function(){this._ticking||(requestAnimationFrame(this.update.bind(this)),this._ticking=!0)},a.prototype._getOffset=function(a){return a.getBoundingClientRect().top+window.pageYOffset},a.prototype._getContainerHeight=function(){return this._optionsContainer.innerHeight||this._optionsContainer.offsetHeight},a.prototype._create=function(){this._handlerBind(),this._optionsContainer.addEventListener("scroll",this._handlerBind,!1),this._optionsContainer.addEventListener("resize",this._handlerBind,!1)},a.prototype._destroy=function(){this._optionsContainer.removeEventListener("scroll",this._handlerBind,!1),this._optionsContainer.removeEventListener("resize",this._handlerBind,!1)},a.prototype._inViewport=function(a){var b=this._lastScroll,c=b+this._getContainerHeight(),d=this._getOffset(a),e=d+this._getContainerHeight(),f=this._optionsThreshold/100*window.innerHeight;return e>=b-f&&c+f>=d&&!a.hasAttribute(this._optionsAttrHidden)},a.prototype._reveal=function(a){var b=a.getAttribute(this._srcAttr)||a.getAttribute(this._optionsAttr);a.hasAttribute(this._optionsAttrBg)?a.style.backgroundImage="url("+b+")":a.setAttribute("src",b),"function"==typeof this._optionsCallback&&this._optionsCallback.call(a),a.removeAttribute(this._optionsAttr),a.removeAttribute(this._optionsAttrRetina),a.removeAttribute(this._optionsAttrBg),a.removeAttribute(this._optionsAttrHidden)},a.prototype.updateSelector=function(){this._nodes=document.querySelectorAll(this._optionsSelector)},a.prototype.update=function(){for(var a=this._nodes.length,b=0;a>b;b++){var c=this._nodes[b];c.hasAttribute(this._optionsAttr)&&this._inViewport(c)&&this._reveal(c)}this._ticking=!1},a});